delimiter $$
CREATE PROCEDURE cargar_datos(IN legajo INT ,IN nombre_apellido varchar(255) ,IN rol_desempeñado VARCHAR(100) ,IN id_proyecto INT ,IN proyecto VARCHAR(50))
BEGIN
 	INSERT INTO part_proyecto(legajo,nombre_apellido,rol_desempeñado,id_proyecto,proyecto)
 		VALUE(legajo,nombre_apellido,rol_desempeñado,id_proyecto,proyecto);

END  
$$

CALL cargar_datos(100,'Juan carlos','tester',2,'pro_Atlantis');
CALL cargar_datos(101,'Jose Carlos','Diseñador',3,'Pro_Aurora');
CALL cargar_datos(102,'Juan Fernando','Ingeniero de Software',2,'pro_Atlantis');
CALL cargar_datos(103,'Valentina Laverde','Analista de Sistemas',2,'pro_Atlantis');
CALL cargar_datos(104,'Rosa María','tester',1,'Pro_cascada');
CALL cargar_datos(105,'Martín Elías','Analista de Sistemas',1,'Pro_cascada');
CALL cargar_datos(106,'Elvia Muñoz','Líder de Proyecto',1,'Pro_cascada');
CALL cargar_datos(107,'Sara Teresa','Gerente de Proyecto',2,'pro_Atlantis');
CALL cargar_datos(108,'Maria jose','Diseñador',2,'pro_Atlantis');
cALL cargar_datos(109,'Hugo Andres ','Gerente de Proyecto',3,'Pro_Aurora');
CALL cargar_datos(110,'Marcela Rincón','tester',3,'Pro_Aurora');
CALL cargar_datos(111,'Javier Sanchez','Ingeniero de Software',3,'Pro_Aurora');
CALL cargar_datos(112,'Margarita Suárez','Gerente de Proyecto',1,'Pro_cascada');
CALL cargar_datos(113,'Jorge Lazaro','Analista de Sistemas.',3,'Pro_Aurora');
CALL cargar_datos(114,'Hugo Cano','Líder de Proyecto',3,'Pro_Aurora');
CALL cargar_datos(115,'Julieta Ponce','Líder de Proyecto',2,'pro_Atlantis');
CALL cargar_datos(116,'Camilo Enrique ','Ingeniero de Software',1,'Pro_cascada');
CALL cargar_datos(117,'Tulia Adriana','Diseñador',1,'Pro_cascada');

delimiter $$
CREATE PROCEDURE insert_facturacion(IN cliente VARCHAR(255),IN id_proyecto INT ,IN proyecto VARCHAR(255),IN cost_proyecto double)
BEGIN 
	INSERT INTO facturacion(cliente,id_proyecto,proyecto,cost_proyecto) 
		VALUES(cliente,id_proyecto,proyecto,cost_proyecto);
END 
$$

CALL insert_facturacion('Pedro',1,'Pro_cascada',500000);
CALL insert_facturacion('Martinez',2,'pro_Atlantis',250000);
CALL insert_facturacion('Maria',3,'Pro_Aurora',350000);



################################trigger que me permiten mandar de manera ordenada los proyectos a su respectiva liquidacion mensual 

delimiter $$ 
CREATE TRIGGER insert_proyec_1 after INSERT ON part_proyecto
FOR EACH ROW 
BEGIN 
DECLARE   cliente VARCHAR(60);
	if(new.id_proyecto= 1 ) thEn 
	
	SELECT  fact.cliente INTO @cliente 
	FROM part_proyecto part 
		INNER JOIN facturacion fact on(part.id_proyecto=fact.id_proyecto)
		WHERE part.legajo=new.legajo; 
		
	INSERT liqui_proyect_1(legajo,rol_desempeñado,cliente,id_proyecto,proyecto,fecha_liquidacion)
		VALUES(new.legajo,new.rol_desempeñado,@cliente,new.id_proyecto,new.proyecto,'2022-03-31');

		END if;
END 
$$;


delimiter $$ 
CREATE TRIGGER insert_proyec_2 AFTER INSERT ON part_proyecto
FOR EACH ROW 
BEGIN 
DECLARE   cliente VARCHAR(60);
	if(new.id_proyecto= 2 ) thEn 
	
	SELECT  fact.cliente INTO @cliente 
	FROM part_proyecto part 
		INNER JOIN facturacion fact on(part.id_proyecto=fact.id_proyecto)
		WHERE part.legajo=new.legajo; 
		
	INSERT liqui_proyect_2(legajo,rol_desempeñado,cliente,id_proyecto,proyecto,fecha_liquidacion)
		VALUES(new.legajo,new.rol_desempeñado,@cliente,new.id_proyecto,new.proyecto,'2022-03-31');
		END if;
END 
$$;

delimiter $$ 
CREATE TRIGGER insert_proyec_3 AFTER INSERT ON part_proyecto
FOR EACH ROW 
BEGIN 
DECLARE   cliente VARCHAR(60);
	if(new.id_proyecto= 3) thEn 
	
	SELECT  fact.cliente INTO @cliente 
	FROM part_proyecto part 
		INNER JOIN facturacion fact on(part.id_proyecto=fact.id_proyecto)
		WHERE part.legajo=new.legajo; 

	INSERT liqui_proyect_3(legajo,rol_desempeñado,cliente,id_proyecto,proyecto,fecha_liquidacion)
		VALUES(new.legajo,new.rol_desempeñado,@cliente,new.id_proyecto,new.proyecto,'2022-03-31');
		END if;
END 
$$;



######################################## los procedures respectivos que te permiten ejecutar el reajuste de cuenta 


delimiter $$
create PROCEDURE reajuste_horas_cuenta_1(in legajo INT,IN id_proyecto int ,in horas INT )
BEGIN
DECLARE nombre VARCHAR(60);
	SELECT liq.`rol_desempeñado` INTO @nombre
	FROM liqui_proyect_1 liq 
	WHERE liq.legajo=legajo  ; 
 	INSERT INTO  liqui_proyect_1 (legajo,rol_desempeñado,cliente,id_proyecto,proyecto,cant_horas_mes,fecha_liquidacion,estado_cuenta)
 		VALUES(legajo,@nombre,'pedro',id_proyecto,'reajustamos horas',- horas,'2022-04-19','');
END 
$$ 


delimiter $$
create PROCEDURE reajuste_horas_cuenta_2(in legajo INT,IN id_proyecto int ,in horas INT )
BEGIN
DECLARE nombre VARCHAR(60);
	SELECT liq.`rol_desempeñado` INTO @nombre
	FROM liqui_proyect_2 liq 
	WHERE liq.legajo=legajo  ; 
 	INSERT INTO  liqui_proyect_2 (legajo,rol_desempeñado,cliente,id_proyecto,proyecto,cant_horas_mes,fecha_liquidacion,estado_cuenta)
 		VALUES(legajo,@nombre,'Martinez',id_proyecto,'reajustamos horas',- horas,'2022-04-19','');
END 
$$ 

delimiter $$
create PROCEDURE reajuste_horas_cuenta_3(in legajo INT,IN id_proyecto int ,in horas INT )
BEGIN
DECLARE nombre VARCHAR(60);
	SELECT liq.`rol_desempeñado` INTO @nombre
	FROM liqui_proyect_3 liq 
	WHERE liq.legajo=legajo  ; 
 	INSERT INTO  liqui_proyect_3 (legajo,rol_desempeñado,cliente,id_proyecto,proyecto,cant_horas_mes,fecha_liquidacion,estado_cuenta)
 		VALUES(legajo,@nombre,'Maria',id_proyecto,'reajustamos horas',- horas,'2022-04-19','');
END 
$$ 

call insert_proyect();
CALL estado_cuenta_proyect_1(@total,1,'2022-04-16');
CALL estado_cuenta_proyect_2(@total,2,'2022-04-25');
call estado_cuenta_proyect_3(@total,3,'2022-04-8');
CALL reajuste_horas_cuenta_1(112,1,20);
CALL reajuste_horas_cuenta_2(115,2,45);
CALL reajuste_horas_cuenta_3(110,3,20);
CALL actualizar_liquidacion()
